{% extends "base.html" %}

{% block title %}Início - Painel de Comando{% endblock %}

{% block content %}
<!-- User Profile Section -->
<div class="row mb-4" id="user-profile-section" style="display: none;">
    <div class="col-12">
        <div class="card glass-effect shadow-premium border-0">
            <div class="card-body p-4 position-relative">
                <div class="row align-items-center g-4">
                    <div class="col-auto">
                        <div class="user-avatar">
                            <img id="user-photo" 
                                 src="https://ui-avatars.com/api/?name=User&size=96&background=4285f4&color=fff&bold=true" 
                                 alt="User Photo" 
                                 loading="lazy">
                        </div>
                    </div>
                    <div class="col">
                        <h3 class="mb-2" id="user-greeting">Bem-vindo!</h3>
                        <p class="mb-0" id="user-email">
                            <span>Carregando...</span>
                        </p>
                        <p class="mb-0 text-muted mt-2" id="user-date-info" style="display: none;"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row justify-content-center my-5">
    <div class="col-12">
        <div class="app-logos-wrapper">
            <a href="{{ url_for('gmail_page') }}" class="app-logo-card gmail" title="Acessar Gmail">
                <span class="logo-badge gmail-badge">
                    <i class="fas fa-envelope"></i>
                </span>
                <img src="{{ url_for('serve_logo', filename='Gmail_icon_(2020).svg.png') }}" alt="Gmail logo" loading="lazy">
                <span class="logo-label">Gmail</span>
            </a>
            <a href="{{ url_for('sheets_page') }}" class="app-logo-card sheets" title="Acessar Google Sheets">
                <span class="logo-badge sheets-badge">
                    <i class="fas fa-table"></i>
                </span>
                <img src="{{ url_for('serve_logo', filename='Google_Sheets_2020_Logo.svg.png') }}" alt="Google Sheets logo" loading="lazy">
                <span class="logo-label">Sheets</span>
            </a>
            <a href="{{ url_for('drive_page') }}" class="app-logo-card drive" title="Acessar Google Drive">
                <span class="logo-badge drive-badge">
                    <i class="fas fa-cloud"></i>
                </span>
                <img src="{{ url_for('serve_logo', filename='google-drive-icon-google-product-illustration-free.png') }}" alt="Google Drive logo" loading="lazy">
                <span class="logo-label">Drive</span>
            </a>
        </div>
    </div>
</div>

<!-- Status Section removida: conteúdo disponível na página de configurações -->
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Carrega perfil do usuário
    loadUserProfile();

    function loadUserProfile() {
        fetch('/api/user-profile')
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    console.log('Erro ao carregar perfil:', data.error);
                    return;
                }

                const profileSection = document.getElementById('user-profile-section');
                const userEmail = document.getElementById('user-email').querySelector('span');
                const userGreeting = document.getElementById('user-greeting');
                const userPhoto = document.getElementById('user-photo');
                const userDateInfo = document.getElementById('user-date-info');

                if (data.email) {
                    let displayName = data.name || data.given_name || data.email.split('@')[0];

                    if (!data.name && !data.given_name) {
                        displayName = data.email.split('@')[0]
                            .replace(/[._]/g, ' ')
                            .split(' ')
                            .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                            .join(' ');
                    }

                    userEmail.textContent = data.email;
                    userGreeting.textContent = `Bem-vindo, ${displayName}!`;

                    if (data.picture) {
                        userPhoto.src = data.picture;
                        userPhoto.alt = displayName;
                    } else {
                        const initials = displayName.split(' ').map(n => n[0]).join('').substring(0, 2);
                        userPhoto.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(displayName)}&size=80&background=4285f4&color=fff&bold=true`;
                        userPhoto.alt = displayName;
                    }

                    if (userDateInfo) {
                        const now = new Date();
                        const weekdayName = now.toLocaleDateString('pt-BR', { weekday: 'long' });
                        const weekday = weekdayName.charAt(0).toUpperCase() + weekdayName.slice(1);
                        const formattedDate = `${String(now.getDate()).padStart(2, '0')}/${String(now.getMonth() + 1).padStart(2, '0')}/${now.getFullYear()}`;
                        userDateInfo.textContent = `Hoje é ${weekday}, ${formattedDate}.`;
                        userDateInfo.style.display = 'block';
                    }

                    profileSection.style.display = 'block';
                    profileSection.classList.add('fade-in');
                }
            })
            .catch(error => {
                console.error('Erro ao carregar perfil do usuário:', error);
            });
    }
});
</script>
{% endblock %}
